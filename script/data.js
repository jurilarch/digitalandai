const coffees = {
    "coffeshop": [
        {
            "name":              "Caroma - Ethiopia",
            "image":             "DSC06918.png",
            "country":           "Ethiopia",
            "region":            "Guji",
            "sea_level":         "1.800 - 2.200m",
            "sca":               "87.25",
            "flavours":   [
                "Pfirsich",
                "Pflaume",
                "Zitrone",
                "Jasmin",
                "Hagebutte",
                "Teeartig"
            ],
            "appointment_label": "ቀጠሮ - Auf Anfrage",
            "colors": "caroma-red",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": true,
            "is_back": false
        },
        {
            "name":              "Caroma - Peru",
            "image":             "DSC06917.png",
            "country":           "Peru",
            "region":            "San Pedro",
            "sea_level":         "1.600 - 2.000m",
            "sca":               "82",
            "flavours":   [
                "Voller Körper",
                "Leichte Würze",
                "Blumig"
            ],
            "appointment_label": "Haga una cita",
            "colors": "caroma-green",
            "ausgetrunken": false,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Caroma - Julia",
            "image":             "DSC06915.png",
            "country":           "Congo, Ethiopia, Ruanda, Honduras",
            "region":            "...",
            "sea_level":         "N/A",
            "sca":               "84",
            "flavours":   [
                "Hagebutte",
                "Kirsche",
                "Reife Aprikose"
            ],
            "appointment_label": "Lossmors tuschn",
            "colors": "caroma-bronze",
            "ausgetrunken": false,
            "is_new": false,
            "is_limited": false,
            "is_back": true
        },
        {
            "name":              "Caroma - Honduras",
            "image":             "DSC06913.png",
            "country":           "Honduras",
            "region":            "Santa Rosa de Copán",
            "sea_level":         "1.100 - 1.300m",
            "sca":               "84",
            "flavours":   [
                "Karamell",
                "Honig",
                "Leicht Floreal",
                "Zitrusartig",
                "Orange"
            ],
            "appointment_label": "Concertar una cita",
            "colors": "caroma-orange",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Caffè Lab – Etiopia",
            "image":             "DSC06867.png",
            "country":           "Ethiopia",
            "region":            "Bona Zuria/Sidama",
            "sea_level":         "2.190m",
            "sca":               "87",
            "flavours":   [
                "White Grapes",
                "Orange",
                "Peach"
            ],
            "appointment_label": "Make an appointment",
            "colors": "caffe-lab",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Caffè Lab – Costarica",
            "image":             "DSC06868.png",
            "country":           "Entre Rios",
            "region":            "Bona Zuria/Sidama",
            "sea_level":         "2.100 - 1.400m",
            "sca":               "85.75",
            "flavours":   [
                "Citrus Fruits",
                "Cherry",
                "Caramel"
            ],
            "appointment_label": "Schedule a ☕ date",
            "colors": "caffe-lab",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Caffè Lab – Guatemala",
            "image":             "DSC06869.png",
            "country":           "Guatemala",
            "region":            "Antigua",
            "sea_level":         "1.900m",
            "sca":               "88",
            "flavours":   [
                "Peach",
                "Flowers",
                "Green Tea"
            ],
            "appointment_label": "Fancy a cuppa?",
            "colors": "caffe-lab",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Caffè Lab – Kenya",
            "image":             "DSC06870.png",
            "country":           "Kenya",
            "region":            "Nyeri",
            "sea_level":         "1.750m",
            "sca":               "87",
            "flavours":   [
                "Lime",
                "Ginger",
                "Jasmin"
            ],
            "appointment_label": "I want this",
            "colors": "caffe-lab",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Caroma – Guatemala",
            "image":             "DSC06871.png",
            "country":           "Guatemala",
            "region":            "Lampocoy",
            "sea_level":         "1.000 - 1.350m",
            "sca":               "81",
            "flavours":   [
                "Karamell",
                "Pekanuss",
                "Feine Fruchtnoten",
                "Johannisbeere",
                "Südfrüchte"
            ],
            "appointment_label": "Arrange a meeting",
            "colors": "caroma-orange",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Caroma – Lake Kivu Bio",
            "image":             "DSC06866.png",
            "country":           "Congo",
            "region":            "Lake Kivu",
            "sea_level":         "1.400 - 1.800m",
            "sca":               "84.5",
            "flavours":   [
                "Winey",
                "Ripe Red Fruits",
                "Balanced Body",
            ],
            "appointment_label": "An appointment for the books",
            "colors": "caroma-red",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "AH Bräu – Noah",
            "image":             "DSC06872.png",
            "country":           "Brazil",
            "region":            "N/A",
            "sea_level":         "700 - 1.200m",
            "sca":               "N/A",
            "flavours":   [
                "Pleasant acidity",
                "Chocolate",
                "Fruit",
            ],
            "appointment_label": "Book appointment",
            "colors": "ahbraeu",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Man vs Machine – Diima Chelbesa",
            "image":             "DSC06873.png",
            "country":           "Ethiopia",
            "region":            "Gedeo",
            "sea_level":         "2.000 - 2.300m",
            "sca":               "N/A",
            "flavours":   [
                "Berries",
                "Bergamot",
                "Cotton Candy",
                "Creamy",
            ],
            "appointment_label": "Arrange a date",
            "colors": "man-vs-machine",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Qbo – Guatemala",
            "image":             "DSC06874.png",
            "country":           "Guatemala",
            "region":            "Huehuetenango",
            "sea_level":         "1.200 - 1.900m",
            "sca":               "N/A",
            "flavours":   [
                "Roasted hazelnut",
                "Caramel",
            ],
            "appointment_label": "Hang",
            "colors": "qbo",
            "contributor": "Martin B.",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        // {
        //     "name":              "Meini’s Roast",
        //     "image":             "DSC06875.png",
        //     "country":           "Ethiopia",
        //     "region":            "Sidamo",
        //     "sea_level":         "N/A",
        //     "sca":               "N/A",
        //     "flavours":   [],
        //     "appointment_label": "Meet",
        //     "colors": "qbo",
        //     "contributor": "Meinhard P.",
        //     "ausgetrunken": true,
        //     "is_new": false,
        //     "is_limited": false,
        //     "is_back": false
        // },
        {
            "name":              "Sebastians’s Import",
            "image":             "DSC06875.png",
            "country":           "-",
            "region":            "-",
            "sea_level":         "N/A",
            "sca":               "N/A",
            "flavours":   [],
            "appointment_label": "Experience the unknown",
            "colors": "luv",
            "contributor": "Sebastian R.",
            "ausgetrunken": false,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Dietrichs – Papua Neuguinea",
            "image":             "DSC06905.png",
            "country":           "Papua Neuguinea",
            "region":            "Waghi Valley",
            "sea_level":         "1.400 - 1.450m",
            "sca":               "N/A",
            "flavours":   [
                "Komplex",
                "Fein Würzig",
                "Helle Schokolade",
            ],
            "appointment_label": "Fix meeting",
            "colors": "dietrichs",
            "contributor": "Sebastian Z.",
            "ausgetrunken": true,
            "is_new": false,
            "is_limited": false,
            "is_back": false
        },

        {
            "name":              "Round Hill Roastery - Isabel #1",
            "image":             "rhr_isabel1.png",
            "country":           "Honduras",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Fix meeting",
            "colors": "qbo",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },

        {
            "name":              "Man vs Machine - Shifa Family",
            "image":             "mvm_shifa.png",
            "country":           "",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Fix meeting",
            "colors": "man-vs-machine",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Man vs Machine - Buku Sayisa",
            "image":             "mvm_buku.png",
            "country":           "",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Fix meeting",
            "colors": "caroma-green",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Mocambo Supermiscela",
            "image":             "mocambo_supermiscela.png",
            "country":           "",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Fix meeting",
            "colors": "caroma-green",
            "contributor": "Christine T. & insre lieblings Freundin, Kollegin, die coolste Gitsche af do Welt (Kathi)",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Kuntrawant",
            "image":             "kuntrawant.png",
            "country":           "",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Fix meeting",
            "colors": "qbo",
            "contributor": "Martin B.",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "JB - Standl 20",
            "image":             "jb_standl20.png",
            "country":           "",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Fix meeting",
            "colors": "qbo",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Garage Coffee - Zuriake",
            "image":             "garage_zuriake.png",
            "country":           "",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Fix meeting",
            "colors": "dietrichs",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Garage Coffee - Adado",
            "image":             "garage_adado.png",
            "country":           "",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Fix meeting",
            "colors": "qbo",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Coffeecult - Kolumbien",
            "image":             "coffecult_kolumbien.png",
            "country":           "Kolumbien",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Set-up a meeting",
            "colors": "caroma-green",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },
        {
            "name":              "Coffeecult - Äthiopien",
            "image":             "coffecult_athiopien.png",
            "country":           "Äthiopien",
            "region":            "",
            "sea_level":         "",
            "sca":               "N/A",
            "flavours":   [
            ],
            "appointment_label": "Deliver excellence",
            "colors": "caroma-orange",
            "ausgetrunken": false,
            "is_new": true,
            "is_limited": false,
            "is_back": false
        },
        // {
        //     "name":              "Aeropress",
        //     "image":             "DSC06876.png",
        //     "flavours":   [],
        //     "colors": "",
        //     "contributor": "Meinhard P.",
        //     "ausgetrunken": false,
        //     "is_new": false,
        //     "is_limited": false,
        //     "is_back": false
        // },

    ]
};

function coffeeFilter(coffee, filter) {
    return coffee.name.toLowerCase().indexOf(filter.toLowerCase()) === -1;
}

function loadCoffee(filter=null) {
    coffeshop.innerHTML = "";
    coffees.coffeshop.sort((a, b) => (Number(a.ausgetrunken) - Number(b.ausgetrunken)) /*|| (Number(b.sca) - Number(a.sca))*/ || (a.name.localeCompare(b.name)));
    console.log(coffees.coffeshop);
    for (const coffee of coffees.coffeshop) {
        if (filter != null && coffeeFilter(coffee, filter))
            continue;
        var block = template.cloneNode(true);
        if(!coffee.ausgetrunken) {
            const ad = block.getElementsByClassName('ausgetrunken')[0];
            ad.remove();
        }
        const tags = block.getElementsByClassName("tags")[0];
        const flavour_temp = tags.children[0];
        flavour_temp.remove();
        if(coffee.flavours.length != 0) {
            for (const flavour of coffee.flavours) {
                var flavour_cpy = flavour_temp.cloneNode(true);
                flavour_cpy.innerHTML = flavour_cpy.innerHTML.replace("$flavour", flavour);
                tags.appendChild(flavour_cpy);
            }
        }else{
            tags.parentNode.remove();
        }
        const cont = block.getElementsByClassName("contributor")[0];
        if (!coffee.hasOwnProperty("contributor")){
            cont.remove();
        }
        const appo = block.getElementsByClassName("reserve")[0];
        if (!coffee.hasOwnProperty("appointment_label")){
            appo.remove();
        }
        const n = block.getElementsByClassName("badge-new")[0];
        if (!coffee.is_new){
            n.remove();
        }
        const lim = block.getElementsByClassName("badge-ltd")[0];
        if (!coffee.is_limited){
            lim.remove();
        }
        const back = block.getElementsByClassName("badge-back")[0];
        if (!coffee.is_back){
            back.remove();
        }
        var raw = block.outerHTML;
        for (const [key, value] of Object.entries(coffee)) {
            raw = raw.replaceAll("$"+key, value);
        }
        coffeshop.appendChild(block);
        block.outerHTML = raw;
    }
}

var template = null;
var coffeshop = null;

(function(){
    template = document.getElementById("coffee-template");
    template.remove();
    coffeshop = document.getElementById("coffeeshop");
    loadCoffee();
    console.log(document.getElementById("search"));
    document.getElementById("search").addEventListener("input", e => {
        if (e.srcElement.value.length > 0) {
            loadCoffee(e.srcElement.value);
        } else {
            loadCoffee();
        }
    })
})();